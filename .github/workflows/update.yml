name: Hass-Addons-updatepy

on: 
  push:
    branches: 
      - cicd
  # schedule:
  #   - cron: '* * 1,14,28 * *'

jobs:
  run-update-py:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with: 
          ref: 'main'
          persist-credentials: false 
          fetch-depth: 0 

      - name: Install dependecies
        uses: VaultVulp/action-pipenv@v2.0.1
        with:
          command: install
          
      - name: Run update.py
        uses: VaultVulp/action-pipenv@v2.0.1
        with:
          command: run python3 update.py
      
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.push_token }}
          branch: upgrade-staging
          force: true

      